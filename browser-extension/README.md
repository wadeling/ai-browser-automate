# AI浏览器自动化助手 - 浏览器插件

一个智能的浏览器自动化插件，能够学习用户的操作行为并生成自动化脚本。

## 🚀 功能特性

### 核心功能
- **智能学习模式**: 自动记录用户的点击、输入、选择、提交等操作
- **详细元素信息**: 记录XPath、CSS Selector、元素属性等完整信息
- **Table信息记录**: 自动检测并记录元素所在的表格信息，包括位置、大小、描述等
- **操作路径可视化**: 以图形化方式展示操作流程，支持弯曲路径和hover详情
- **数据导出**: 支持将学习数据导出为JSON格式

### Table信息记录功能
当用户操作的元素位于表格中时，插件会自动记录以下信息：
- **表格基本信息**: ID、类名、XPath、CSS Selector
- **表格结构**: 行数、列数、总单元格数
- **表格描述**: 通过caption或第一个th元素获取
- **元素位置**: 元素在表格中的具体行号和列号
- **位置索引**: 从0开始的行索引和列索引

### 操作路径可视化
- **节点显示**: 每个操作以节点形式展示，包含操作类型和文本内容
- **连接线**: 带箭头的连接线显示操作顺序
- **弯曲路径**: 当路径过长时，支持蛇形布局避免重叠
- **交互功能**: 支持拖拽、缩放、点击查看详情
- **Hover提示**: 鼠标悬停显示完整的操作信息

## 📦 安装说明

### 方法一：开发者模式安装
1. 下载或克隆项目到本地
2. 打开Chrome浏览器，进入 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目中的 `browser-extension` 文件夹
6. 插件安装完成，会在工具栏显示图标

### 方法二：打包安装
1. 在扩展程序页面点击"打包扩展程序"
2. 选择 `browser-extension` 文件夹
3. 生成 `.crx` 文件后拖拽到浏览器安装

## 🎯 使用方法

### 基本操作流程
1. **开启学习模式**: 点击插件图标，在侧边栏中点击"开启学习模式"
2. **执行操作**: 在网页上正常进行各种操作（点击、输入、选择等）
3. **查看记录**: 在侧边栏中查看实时记录的操作信息
4. **路径可视化**: 点击"查看操作路径"查看图形化的操作流程
5. **结束学习**: 点击"结束学习模式"停止记录
6. **导出数据**: 点击"导出数据"保存学习记录

### Table信息记录示例
当点击表格中的元素时，记录的数据结构如下：
```json
{
  "type": "click",
  "description": "点击 类名为\"status\"的span",
  "timestamp": "2024-01-30T10:30:00.000Z",
  "url": "http://localhost:8000/",
  "element": {
    "table": {
      "tagName": "TABLE",
      "id": "userTable",
      "className": "data-table",
      "xpath": "/html/body/div/table[1]",
      "selector": "#userTable",
      "rows": 4,
      "cells": 18,
      "caption": "用户管理系统数据表",
      "elementPosition": {
        "row": 2,
        "column": 4,
        "rowIndex": 1,
        "cellIndex": 3
      }
    },
    "tagName": "SPAN",
    "id": "",
    "className": "status abnormal",
    "textContent": "异常",
    "xpath": "/html/body/div/table[1]/tbody[1]/tr[2]/td[4]/span[1]",
    "selector": ".status.abnormal"
  }
}
```

### 路径可视化功能
- **直线模式**: 默认的线性布局，适合操作步骤较少的情况
- **弯曲模式**: 点击"切换弯曲"按钮，使用网格布局避免节点重叠
- **缩放控制**: 使用鼠标滚轮或按钮进行缩放
- **拖拽移动**: 点击拖拽移动整个路径视图
- **节点交互**: 点击节点查看详细信息，悬停显示完整数据

## 🛠️ 开发说明

### 项目结构
```
browser-extension/
├── manifest.json          # 插件配置文件
├── background.js          # 后台脚本
├── content.js            # 内容脚本（记录用户操作）
├── sidepanel.html        # 侧边栏界面
├── sidepanel.css         # 侧边栏样式
├── sidepanel.js          # 侧边栏逻辑
└── icons/                # 插件图标
```

### 核心文件说明

#### content.js
- 监听用户操作事件（点击、输入、选择、提交）
- 生成XPath和CSS Selector
- 检测元素所在的表格信息
- 发送操作数据到后台脚本和侧边栏

#### sidepanel.js
- 管理学习模式状态
- 显示操作记录表格
- 实现路径可视化功能
- 处理数据导出和清空

#### background.js
- 管理插件生命周期
- 处理跨页面通信
- 存储学习数据

### 扩展开发
如需添加新的操作类型或修改记录逻辑：
1. 在 `content.js` 中添加新的事件监听器
2. 在 `sidepanel.js` 中添加对应的显示逻辑
3. 更新 `manifest.json` 中的权限配置

## 🔧 技术特性

### 元素定位
- **XPath生成**: 类似Chrome开发者工具的Copy full XPath
- **CSS Selector**: 类似Chrome开发者工具的Copy selector
- **智能选择**: 优先使用ID，其次使用类名，最后使用完整路径

### Table信息检测
- **向上遍历**: 从目标元素向上查找最近的TABLE元素
- **位置计算**: 精确计算元素在表格中的行号和列号
- **结构分析**: 统计表格的行数、列数、单元格数
- **描述提取**: 从caption或th元素获取表格描述

### 数据存储
- **本地存储**: 使用Chrome Storage API存储学习数据
- **实时同步**: 操作数据实时同步到侧边栏显示
- **数据导出**: 支持JSON格式导出，便于后续处理

## 🐛 已知问题

1. **复杂表格**: 对于嵌套表格或动态生成的表格，位置计算可能不准确
2. **iframe内容**: 无法记录iframe内部的操作
3. **动态内容**: 对于AJAX动态加载的内容，可能需要重新开启学习模式

## 📝 更新日志

### v1.2.0 (2024-01-30)
- ✨ 新增Table信息记录功能
- ✨ 新增操作路径可视化功能
- ✨ 支持弯曲路径布局
- ✨ 添加hover详情显示
- 🐛 修复元素定位精度问题
- 🎨 优化界面样式和交互体验

### v1.1.0 (2024-01-25)
- ✨ 新增学习模式状态管理
- ✨ 新增操作记录表格显示
- ✨ 新增数据导出功能
- 🎨 优化侧边栏界面设计

### v1.0.0 (2024-01-20)
- 🎉 初始版本发布
- ✨ 基础操作记录功能
- ✨ XPath和CSS Selector生成
- ✨ 简单的侧边栏界面

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📞 联系方式

如有问题或建议，请通过GitHub Issues联系。 